<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/course/libs/highlight/styles/github.min.css"> <link href="/course/css/franklin.css" rel=stylesheet > <link href="/course/css/vela.css" rel=stylesheet > <script src="/course/libs/vela/jquery.min.js"></script> <link rel=icon  href="/course/assets/NB_favicon.png"> <title>Neuroblox course</title> <div class="main-nav slideout-menu slideout-menu-left" id=menu > <div class=flex-container > <span class=sidebar-brand > <h3 style='font-size: 25px'>Neuroblox course</h3> </span> </div> <nav class=sidebar-nav > <ul class=metismenu  id=metismenu  > <li><a href="/course/index.html">Home</a> <li><a href="/course/pages/getting_started">Getting Started</a> <li><a href="/course/pages/intro_julia">Introduction to Julia</a> <li><a href="/course/pages/intro_diffeq">Differential Equations with ModelingToolkit</a> <li><a href="/course/pages/intro_plot">Plotting with Makie</a> <li><a href="/course/pages/custom">Blox and Connections in Neuroblox</a> <li><a href="/course/pages/neuron_mass">Neurons, Neural Masses and Sources</a> <li><a href="" class=has-arrow >Circuit Models</a> <ul> <li><a href="/course/pages/circuits">Introduction</a> <li><a href="/course/pages/CS_circuit">Biomimetic Corticostriatal assemblies</a> <li><a href="/course/pages/PING_circuit">Pyramidal-Interneuron Gamma network</a> </ul> <li><a href="/course/pages/decision_making">Decision Making</a> <li><a href="/course/pages/learning">Synaptic Plasticity and Reinforcement Learning</a> <li><a href="/course/pages/DCM">Spectral Dynamic Causal Modeling</a> </ul> </nav> </div> <main id=panel  class="slidout-panel slideout-panel-left"> <div class="toggle-button hamburger hamburger--spin"> <div class=hamburger-box > <div class=hamburger-inner ></div> </div> </div> <h1 class="page title">Plotting with Makie</h1> <hr> <div class=franklin-content ><div class=franklin-toc ><ol><li><a href="#introduction">Introduction</a><li><a href="#plotting_layouts">Plotting layouts</a><li><a href="#plotting_spikes">Plotting spikes</a></ol></div> <h1 id=plotting_with_makie ><a href="#plotting_with_makie" class=header-anchor >Plotting with Makie</a></h1> <h2 id=introduction ><a href="#introduction" class=header-anchor >Introduction</a></h2> <p>Makie &#91;1&#93; is a plotting ecosystem based in Julia. It comes with multiple backends for rendering and displaying plots. For this course we will be using <code>CairoMakie</code> as it has a lot of features for 2D static plots and most computers should support it as it only requires a CPU and no GPU. Makie has a great <a href="https://docs.makie.org/stable/tutorials/getting-started">Getting Started page</a>. We will make use of this tutorial to introduce some basic plotting functions and labelling options.</p> <p>Learning goals:</p> <ul> <li><p>Design layouts with multiple axes in figures.</p> <li><p>Use Makie&#39;s functionality to plot neuron-specific figures.</p> </ul> <h2 id=plotting_layouts ><a href="#plotting_layouts" class=header-anchor >Plotting layouts</a></h2> <p>We&#39;ll now see how to create layouts of multiple subplots within a single window. We&#39;ll use the same data from the Makie tutorial linked above.</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> CairoMakie

seconds = <span class=hljs-number >0</span>:<span class=hljs-number >0.1</span>:<span class=hljs-number >2</span>
measurements = [<span class=hljs-number >8.2</span>, <span class=hljs-number >8.4</span>, <span class=hljs-number >6.3</span>, <span class=hljs-number >9.5</span>, <span class=hljs-number >9.1</span>, <span class=hljs-number >10.5</span>, <span class=hljs-number >8.6</span>, <span class=hljs-number >8.2</span>, <span class=hljs-number >10.5</span>, <span class=hljs-number >8.5</span>, <span class=hljs-number >7.2</span>,
        <span class=hljs-number >8.8</span>, <span class=hljs-number >9.7</span>, <span class=hljs-number >10.8</span>, <span class=hljs-number >12.5</span>, <span class=hljs-number >11.6</span>, <span class=hljs-number >12.1</span>, <span class=hljs-number >12.1</span>, <span class=hljs-number >15.1</span>, <span class=hljs-number >14.7</span>, <span class=hljs-number >13.1</span>]

fig = Figure(title=<span class=hljs-string >&quot;Line &amp; Scatter layout&quot;</span>)
axs = [Axis(fig[<span class=hljs-number >1</span>,<span class=hljs-number >1</span>], title = <span class=hljs-string >&quot;Line plot&quot;</span>, xlabel = <span class=hljs-string >&quot;Time [sec]&quot;</span>, ylabel = <span class=hljs-string >&quot;Measurement&quot;</span>),
        Axis(fig[<span class=hljs-number >2</span>,<span class=hljs-number >1</span>], title = <span class=hljs-string >&quot;Scatter plot&quot;</span>, xlabel = <span class=hljs-string >&quot;Time [sec]&quot;</span>, ylabel = <span class=hljs-string >&quot;Measurement&quot;</span>)]

lines!(axs[<span class=hljs-number >1</span>], seconds, measurements)
scatter!(axs[<span class=hljs-number >2</span>], seconds, measurements)

fig</code></pre> <img src="/course/assets/pages/intro_plot/code/output/layout.svg" alt=""> <blockquote> <p>Note: Plot functions in Makie also work without defining a <code>Figure</code> and an <code>Axis</code> object explicitly. E.g. plotting with <code>lines&#40;seconds, measurements&#41;</code> or <code>scatter&#40;seconds, measurements&#41;</code> . However in this case we won&#39;t have all the customization options for the plot axes readily available.</p> </blockquote> <p>Plotting layouts in Makie is quite intuitive. We can treat the <code>Figure</code> object as a matrix of &#40;sub&#41;plot positions. In the example above we organized the two plots on a single column on positions <code>fig&#91;1,1&#93;</code> and <code>fig&#91;2,1&#93;</code> &#40;remember that Julia is an 1-index language&#33;&#41;. We then input these grid positions of the figure to the respective <code>Axis</code> object to define the 2D axes which will contain each plot. When defining an <code>Axis</code> there are multiple options to affect its appearance and alignment, see the <a href="https://docs.makie.org/v0.21/reference/blocks/axis">Axis documentation page</a> for more details. We can also change an <code>Axis</code> after it has been constructed. For instance we could hide the x-axis label and ticks on the top plot above, since it is a duplicate of the x-axis of the bottom plot. We will keep the grid lines though, because it is easier to read the x-axis values this way.</p> <pre><code class="julia hljs"><span class=hljs-comment ># `grid=false` avoids hiding the x grid lines</span>
hidexdecorations!(axs[<span class=hljs-number >1</span>], grid=<span class=hljs-literal >false</span>)

<span class=hljs-comment ># Now we can display the figure again with the updated axes</span>
fig</code></pre> <img src="/course/assets/pages/intro_plot/code/output/layout_hidex.svg" alt=""> <h2 id=plotting_spikes ><a href="#plotting_spikes" class=header-anchor >Plotting spikes</a></h2> <p>We will now combine the Makie and the Differential Equations ecosystems to start plotting more meaningful results after simulating neuronal models. We will use the Izhikevich model from the last section in its fast-spiking regime. Besides the spiking event, we will add a second event that increases the external current flowing into the neuron at a specific time during simulation. We will count and plot the spikes that the neuron emits within time windows of a given width both before and after the change in external current.</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> ModelingToolkit
<span class=hljs-keyword >using</span> ModelingToolkit: t_nounits as t, D_nounits as D
<span class=hljs-keyword >using</span> OrdinaryDiffEq

<span class=hljs-meta >@variables</span> v(t)=-<span class=hljs-number >65</span> u(t)=-<span class=hljs-number >13</span>
<span class=hljs-comment ># Parameters for fast spiking.</span>
<span class=hljs-meta >@parameters</span> a=<span class=hljs-number >0.1</span> b=<span class=hljs-number >0.2</span> c=-<span class=hljs-number >65</span> d=<span class=hljs-number >2</span> I=<span class=hljs-number >10</span>

eqs = [D(v) ~ <span class=hljs-number >0.04</span> * v ^ <span class=hljs-number >2</span> + <span class=hljs-number >5</span> * v + <span class=hljs-number >140</span> - u + I,
        D(u) ~ a * (b * v - u)]

spike_threshold = <span class=hljs-number >30</span>
t_bigger_stimulation = <span class=hljs-number >250</span>
spike_event = (v &gt; spike_threshold) =&gt; [u ~ u + d, v ~ c]
stimulation_event = [t_bigger_stimulation] =&gt; [I ~ I + <span class=hljs-number >10</span>]

<span class=hljs-meta >@named</span> izh_system = ODESystem(eqs, t, [v, u], [a, b, c, d, I]; discrete_events = [spike_event, stimulation_event])
izh_simple = structural_simplify(izh_system)

u0 = [v =&gt; -<span class=hljs-number >65.0</span>, u =&gt; -<span class=hljs-number >13.0</span>]
tspan = (<span class=hljs-number >0.0</span>, <span class=hljs-number >400.0</span>)

izh_prob = ODEProblem(izh_simple, u0, tspan)
izh_sol = solve(izh_prob)

<span class=hljs-comment ># retrieve the voltage potential variable from solution</span>
V_izh = izh_sol[v]
<span class=hljs-comment ># retrieve all stimulation timesteps that the integrator took to solve the ODEProblem</span>
timepoints = izh_sol.t

<span class=hljs-comment ># set a time window width for spike counting</span>
t_window = <span class=hljs-number >20</span>
<span class=hljs-comment ># split time into bins of size `t_window`</span>
t_range = first(tspan):t_window:last(tspan)
<span class=hljs-comment ># initialize an empty vector to hold the spike values.</span>
spikes = zeros(length(t_range) - <span class=hljs-number >1</span>)

<span class=hljs-comment ># loop over the timepoints at which every time window begins</span>
<span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> eachindex(t_range[<span class=hljs-number >1</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>])
    <span class=hljs-comment ># find the indices of timepoints that fall within the current time window</span>
    idxs = findall(t -&gt; t_range[i] &lt;= t &lt;= t_range[i+<span class=hljs-number >1</span>], timepoints)
    <span class=hljs-comment ># count the number of spikes within the same window</span>
    spikes[i] = count(V_izh[idxs] .&gt; spike_threshold) <span class=hljs-comment >## counts the number of True elements in a Boolean vector</span>
<span class=hljs-keyword >end</span>

fig = Figure()
ax = Axis(fig[<span class=hljs-number >1</span>,<span class=hljs-number >1</span>], xlabel=<span class=hljs-string >&quot;Time (sec)&quot;</span>, ylabel=<span class=hljs-string >&quot;Spikes&quot;</span>)

<span class=hljs-comment ># plot spikes for each time window</span>
barplot!(ax, t_range[<span class=hljs-number >1</span>:<span class=hljs-keyword >end</span>-<span class=hljs-number >1</span>], spikes, label=<span class=hljs-string >&quot;Spikes&quot;</span>)
<span class=hljs-comment ># plot a vertical line to note when the change in current `I` occurred</span>
vlines!(ax, [t_bigger_stimulation]; color=:tomato, linestyle=:dash, linewidth=<span class=hljs-number >4</span>, label=<span class=hljs-string >&quot;Stimulation: I = I+10&quot;</span>)

<span class=hljs-comment ># display the legend</span>
axislegend(position = :lt)
fig</code></pre> <img src="/course/assets/pages/intro_plot/code/output/spikes.svg" alt=""> <h1 id=challenge_problems ><a href="#challenge_problems" class=header-anchor >Challenge Problems</a></h1> <p>See the <a href="/course/pages/intro_diffeq/">Differential Equations in Julia</a></p> <h1 id=references ><a href="#references" class=header-anchor >References</a></h1> <ul> <li><p>&#91;1&#93; Danisch et al., &#40;2021&#41;. Makie.jl: Flexible high-performance data visualization for Julia. Journal of Open Source Software, 6&#40;65&#41;, 3349, https://doi.org/10.21105/joss.03349</p> <li><p>&#91;2&#93; https://docs.makie.org/stable/</p> </ul> <div class=page-foot > <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Neuroblox Inc. Last modified: January 10, 2025. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </main> <script src="/course/libs/vela/metisMenu.min.js"></script> <script src="/course/libs/vela/slideout.min.js"></script> <script src="/course/libs/highlight/highlight.min.js"></script> <script>hljs.highlightAll();hljs.configure({tabReplace: ' '});</script>